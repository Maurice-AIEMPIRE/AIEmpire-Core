name: Auto Task Generation

on:
  # Run every 6 hours to generate fresh tasks
  schedule:
    - cron: '0 */6 * * *'
  
  # Allow manual trigger
  workflow_dispatch:
    inputs:
      task_count:
        description: 'Number of tasks to generate'
        required: false
        default: '25'

jobs:
  generate-tasks:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install aiohttp pyyaml
      
      - name: Generate tasks
        env:
          MOONSHOT_API_KEY: ${{ secrets.MOONSHOT_API_KEY }}
        run: |
          python3 task_generator.py
      
      - name: Create pull request with new tasks
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'Auto-generated tasks'
          title: 'ðŸ¤– Auto-generated tasks for the next work session'
          body: |
            ## ðŸ¤– Automatically Generated Tasks
            
            This PR contains automatically generated tasks to keep the team busy.
            
            ### Summary
            - Tasks generated: Check atomic-reactor/tasks/ directory
            - Estimated work time: Check PR files
            - Mix of: Content, Research, Code, Business, and Optimization tasks
            
            ### Next Steps
            1. Review the tasks
            2. Merge if they look good
            3. Run: `python3 atomic-reactor/run_tasks.py` to execute them
            
            Generated by: Auto Task Generation workflow
          branch: auto-tasks-${{ github.run_number }}
          delete-branch: true
